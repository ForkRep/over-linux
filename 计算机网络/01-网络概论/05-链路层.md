## 一 链路层概述

> **结点**(node)与**链路**(link)：运行连层层协议的设备即为结点，如：主机、路由器、交换机、Wifi接入点等。沿着通信路径连接相邻结点的通信信道为链路。  

为了将一个数据报从源主机传输到目的主机，数据报必须经一系列链路的传输，如：
```
在笔记本上通过wifi访问互联网，需要经过：
    笔记本与wifi接入点之间的wifi链路；
    wifi接入点与链路层交换机之间的以太网链路；
    链路层交换机与路由器之间的链路；
    路由之间的链路；
    交换机和服务器之间的以太网链路
```   

链路层的主题部分是 **网络适配器**（network adapter），也即网络接口卡（Network Interface Card，NIC），网络适配器的核心是链路层控制器，该控制器通常是一个实现了很多链路层服务的芯片，所以链路层的大多功能都是依赖硬件实现的。  

链路层提供的服务包括：
- 成帧（framing）：封装网络层数据包为链路层帧格式。
- 链路接入：帧在链路的传输规则，对应协议为媒体访问控制协议（MAC，Medium Access Control）。
- 可靠交付：保证无差错的经过链路层，与TCP协议一样，也是通过确认和重传保证。可靠交付主要用于容易产生高差错率的链路，如无线链路一般是在本地纠正差错，而不是在传输层、应用层来实现数据重传。对于一些低差错的链路如光纤、双绞线，可靠交付是不必要的开销。
- 差错检测和纠正：链路层的比特级差错往往由于信号衰减、电磁干扰产生。链路层的纠错依赖于硬件，但是能够准确的确定帧中差错出现的位置

## 二 差错检测和纠正技术

### 2.0 如何进行差错检测

在发送结点，为了保护比特出现差错，使用差错检测和纠正比特（Error-Detection and-Correction， EDC）来增强数据D。  

要保护的数据包括：网络层中传递下来的数据报、链路帧首部中的链路级寻址信息、序号等字段。  

链路级帧中的D和EDG都被发送到接收结点，在接收结点接收到的比特序列为 $D‘$ 和 $EDG'$，此时由于传输过程中的比特反转，$D‘$ 和 $EDG'$ 可能已经与初始的D和EDG不同了。  

在接收方，最大的挑战是确定 $D‘$ 和 $EDG'$  与初始状态是否相同，这种检测也仍然有可能出现 未检测出比特差错（undetected bit error）。检测和纠错技术越复杂，开销就会越大。  

常见的检测差错技术有三种：
- 奇偶校验（parity bit）：用来描述差错检测、纠正背后隐含的基本思想
- 检验和方法：通常用于传输层
- 循环冗余检测（CRC）：通常应用于链路层，是现在广泛应用的差错检测技术。

### 2.1 奇偶校验

![](../images/net/base-05-01.svg)  

如图所示，要发送的信息 D 有 d 个比特，在偶校验防范中，发送方只需要额外包含一个比特，使得 d + 1个比特中 值为1的比特数目总数是偶数。在奇校验中，选择校验比特之的使得有奇数个1。此时，在接收方，只需要统计接收的 d+1 个比特中 1的数目即可，比如在偶校验中，如果发现了奇数个个值为1的比特，接收方就会知道出现了奇数个比特差错。    

如果出现了偶数个比特差错，就会导致一个未检测出的差错。还有更恶劣的情况，差错往往不会在一个分组中同时出现，而是会以突发方式聚集在一起，造成单比奇偶校验宝华的一帧中检测出差错的概率达到50%。  

对于上述情况，可以使用二维化方案：  

![](../images/net/base-05-02.svg)  

上述方案不但能检测出单个比特差错，还能利用列、行索引来找到差错的比特并纠正。  

延伸：接收方检测和纠正差错的能力被称为 前向纠错（Forward Error Correction，FEC），这些技术通常用于音频的存储和回放设备中。   

### 2.2 检验和方法

在检验和技术中，net-09图中的 d 比特数据被作为一个 k 比特整数的序列处理，最简单的检测方式是将这 k 比特证书加起来，用得到的和作为差错检测比特。 **因特网检验和**（Internet checksum）方法使用了该原理，即数据的字节作为16比特的整数来对待并求和，和的反码即为携带在报文首部的尹腾网校验和。  

接收方通过对接收的数据的和取反码，检测其结果是偶全为1比特来检测检验和。  

TCP和UDP检验和只用了16比特，而链路层由于基于硬件实现，性能更高，其CRC提供了更好的保护。   

### 2.3 循环冗余检测

循环冗余检测（Cyclic Redundancy Check，CRC）编码是当前应用最广泛的检测技术，也称为多项式编码，因为该编码能够将要发送的比特串看做为稀疏是0和1的多项式。  

## 三 协议

### 3.0 多路访问链路和协议

有两种网络链路：
- 点对点链路（point-to-point link）：链路的一段单个发送方和链路的另一端单个接收方组成，如点对点协议PPP、高级数据链路控制协议HDLC。
- 广播链路（broadcast link）：能够让多个发送方和接收结点都连接到相同的、单一的、共享的广播信道上，如以太网、无线局域网。   

多个节点可能会同时传输帧，即传输的帧在接收方发生碰撞（collide），此时没有一个接收点能够有效的获得任何传输的帧，涉及碰撞的所有的帧都会丢失。这种情况需要协调，即多路访问协议。  

多路访问协议有三种类型：
- 信道划分协议（channel partitioning protocol）：
- 随机接入协议（random access protocol）：
- 轮流协议（takibg-turns protocol）：